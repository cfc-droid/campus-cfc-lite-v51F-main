<!-- ==========================================================
‚úÖ CFC_FUNC_3_7_COLOR_SYNC_FINAL_V12.3 ‚Äî Historial de Ex√°menes Premium Visual
========================================================== -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìò Historial de Ex√°menes ‚Äî Campus CFC LITE</title>

  <link rel="stylesheet" href="/frontend/css/premium.css?v=20251109" />

  <style>
    /* ==========================================================
       üåó MODO CLARO / OSCURO ‚Äî Sincronizaci√≥n global CFC_THEME_STATE
       ========================================================== */
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin: 0;
      transition: background 0.4s ease, color 0.4s ease;
    }

    /* üåû MODO CLARO */
    body.light-mode {
      background: #ffffff;
      color: #111111;
    }

    /* üåô MODO OSCURO */
    body.dark-mode {
      background: #000000;
      color: #ffffff;
    }

    h2 {
      margin-top: 30px;
      color: #d4af37;
      letter-spacing: 1px;
    }

    /* üßæ Tabla */
    table {
      width: 92%;
      margin: 40px auto;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }

    /* üåû CLARO */
    body.light-mode table {
      background: #fffef8;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border: 1px solid rgba(0,0,0,0.05);
    }

    /* üåô OSCURO */
    body.dark-mode table {
      background: rgba(25,25,25,0.9);
      box-shadow: 0 0 15px rgba(255,215,0,0.1);
      border: 1px solid rgba(255,215,0,0.2);
    }

    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255, 215, 0, 0.1);
      transition: color 0.3s ease, background 0.3s ease;
    }

    th {
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    /* Modo claro */
    body.light-mode th {
      background: rgba(212,175,55,0.15);
      color: #000;
    }
    body.light-mode td {
      color: #111;
    }

    /* Modo oscuro */
    body.dark-mode th {
      background: rgba(255,215,0,0.12);
      color: #ffd700;
    }
    body.dark-mode td {
      color: #eee;
    }

    tr:hover td {
      background: rgba(255,215,0,0.08);
    }

    /* ü™∂ Bot√≥n volver */
    button {
      transition: all 0.3s ease;
      font-weight: 600;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 40px;
    }

    body.light-mode button {
      background: #d4af37;
      color: #000;
      border: 2px solid #d4af37;
    }
    body.dark-mode button {
      background: transparent;
      color: #ffd700;
      border: 2px solid #ffd700;
    }

    button:hover {
      transform: scale(1.03);
    }

    /* üåó Bot√≥n flotante tema */
    #themeToggle {
      position: fixed;
      top: 18px;
      right: 22px;
      background: rgba(255,215,0,0.2);
      border: 2px solid rgba(255,215,0,0.4);
      color: #FFD700;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
      z-index: 9999;
    }

    #themeToggle:hover {
      background: #FFD700;
      color: #000;
      transform: scale(1.05);
    }

  </style>
</head>

<body>
  <!-- üåó Bot√≥n de cambio de tema -->
  <div id="themeToggle" title="Cambiar tema">üåô</div>

  <h2>üìò Historial de Ex√°menes</h2>

  <table id="examResultsTable">
    <thead>
      <tr>
        <th>M√ìDULO</th>
        <th>FECHA Y HORA</th>
        <th>NOTA</th>
        <th>ESTADO</th>
        <th>INTENTOS</th>
        <th>DURACI√ìN</th>
        <th>ERROR A MEJORAR</th>
      </tr>
    </thead>
    <tbody id="examResultsBody">
      <tr><td colspan="7">Cargando historial...</td></tr>
    </tbody>
  </table>

  <button onclick="window.location.href='/frontend/index.html'">üè† Volver al inicio</button>

  <!-- ==========================================================
       ‚úÖ CFC_RESULTS_V10.3_PERSIST_FIX_REAL
       ========================================================== -->
  <script>
  /* ==========================================================
  ‚úÖ CFC_RESULTS_V10.3_PERSIST_FIX_REAL
  ----------------------------------------------------------
  ‚Ä¢ Restaura examResults si est√° vac√≠o, usando examResults_backup
  ‚Ä¢ Sincroniza visualmente con CFC_THEME_STATE
  ‚Ä¢ QA verificado con CFC_LOCK_TOTAL_PERSIST_REAL
  ========================================================== */

  document.addEventListener("DOMContentLoaded", () => {
    const tableBody = document.getElementById("examResultsBody");

    // üîç Intentar cargar resultados principales
    let examResults = JSON.parse(localStorage.getItem("examResults") || "[]");

    // ‚ôªÔ∏è Si no hay resultados, intentar restaurar desde backup
    if (!examResults.length) {
      const backup = JSON.parse(localStorage.getItem("examResults_backup") || "[]");
      if (backup.length) {
        examResults = backup;
        localStorage.setItem("examResults", JSON.stringify(backup));
        console.log("‚ôªÔ∏è CFC_SYNC: examResults restaurado desde backup.");
      }
    }

    // üß© Renderizado del historial
    if (examResults.length === 0) {
      tableBody.innerHTML = `<tr><td colspan="7">‚ö†Ô∏è No hay resultados a√∫n.</td></tr>`;
    } else {
      tableBody.innerHTML = "";
      examResults.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${r.module}</td>
          <td>${r.date || "-"} ${r.time || ""}</td>
          <td>${r.score || 0}%</td>
          <td>${r.status || "-"}</td>
          <td>${r.attempts || 1}</td>
          <td>${r.duration || "-"}</td>
          <td>${r.error || "-"}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    aplicarTemaCFC();
    console.log("üß© CFC_RESULTS_V10.3_PERSIST_FIX_REAL ‚Äî render completo ‚úÖ", new Date().toLocaleString());
  });

  // üåó Tema sincronizado
  function aplicarTemaCFC() {
    const tema = localStorage.getItem("CFC_THEME_STATE") || "dark";
    document.body.classList.toggle("light-mode", tema === "light");
    document.body.classList.toggle("dark-mode", tema === "dark");
    document.getElementById("themeToggle").textContent = tema === "light" ? "üåû" : "üåô";
  }

  window.addEventListener("storage", e => {
    if (e.key === "CFC_THEME_STATE") aplicarTemaCFC();
  });

  document.getElementById("themeToggle").addEventListener("click", () => {
    const current = localStorage.getItem("CFC_THEME_STATE") || "dark";
    const nuevo = current === "dark" ? "light" : "dark";
    localStorage.setItem("CFC_THEME_STATE", nuevo);
    aplicarTemaCFC();
    console.log("üé® CFC_THEME_SWITCH ‚Äî results.html:", nuevo);
  });
  </script>

<!-- üîí CFC-LOCK V72 -->
<script src="../js/domain_lock_v72.js" defer></script> 

<!-- üî• CFC-BUNDLE -->
<script src="../js/bundle_core.min.js" defer></script> 
</body>
</html>
