<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnÃ¡lisis (PAE) â€” Historial</title>

  <!-- CSS global del Campus (heredado, NO modificar) -->
<link rel="stylesheet" href="/frontend/css/style.css" />

<!-- PEA CSS (solo visual) -->
<link rel="stylesheet" href="./css/pea_tokens.css" />
<link rel="stylesheet" href="./css/pea_layout.css" />
<link rel="stylesheet" href="./css/pea_components.css" />

<style>
  /* MOBILE real (incluye landscape) */
@media (max-width: 900px), (pointer: coarse) {

  /* Barra flotante: 1 fila, scroll, y SIN space-between */
  .pea-floatbar.pea-actions{
    width: 100% !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;

    display: flex !important;
    align-items: center !important;

    justify-content: flex-start !important;  /* âœ… CLAVE */
    gap: 42px !important;

    flex-wrap: nowrap !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;

    /* âœ… CLAVE: aire real a la derecha + safe-area */
    padding-left: 42px !important;
    padding-right: calc(24px + env(safe-area-inset-right)) !important;
  }

  .pea-floatbar.pea-actions::-webkit-scrollbar{
    display: none;
  }

  /* Botones */
  .pea-floatbar.pea-actions .btn-main{
    font-size: 11px !important;
    padding: 5px 8px !important;
    line-height: 1 !important;
    min-height: 28px !important;
    border-radius: 999px !important;
    white-space: nowrap !important;
    flex: 0 0 auto !important;
  }  
}
  
</style>

</head>

  <!-- BOTONERA FLOTANTE (misma que las otras pantallas) -->
<div class="pea-floatbar pea-actions"
  style="width: 100%; display: flex; justify-content: space-between; align-items: center; gap: 15px; flex-wrap: wrap;">  
  <button type="button" class="btn-main" onclick="window.location.href='./index.html'">Pantalla principal</button>
  <button type="button" class="btn-main" onclick="window.location.href='./pea_stats_help.html'">CÃ¡lculo de estadÃ­sticas</button>
  <button type="button" class="btn-main" onclick="window.location.href='./pea_screen_register.html'">Cargar registro</button>
  <button type="button" class="btn-main" onclick="window.location.href='/index.html'">Volver al Campus</button>
  <button type="button" class="btn-main" id="pea-btn-theme" onclick="window.peaToggleTheme()">Claro / Oscuro</button>
</div>


  <!-- âœ… CONTENEDOR TIPO "REGISTRO" -->
  <div class="pea-shell">
    <div class="pea-card">

      <!-- HEADER -->
      <header class="pea-header">
        <h1>AnÃ¡lisis (PAE) â€” Historial</h1>
      </header>

      <!-- BANNER LEGAL -->
      <section class="pea-legal-banner">
        <p>Sistema de auditorÃ­a operativa. No interpreta, no aconseja, no diagnostica.</p>
      </section>

      <!-- CONTENEDOR PRINCIPAL: 3 ZONAS VERTICALES (NO NEGOCIABLE) -->
      <main class="pea-history">

        <div class="pea-zone-core-inner">

          <!-- ZONA 1 â€” FILTROS + REGISTROS CRUDOS -->
          <section class="pea-zone pea-zone-core" aria-label="Filtros y registros">

            <!-- FILTROS -->
            <section class="pea-filters pea-register">
<div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
  <h2 style="margin:0;">Filtros</h2>

  <div style="display:flex; align-items:center; gap:8px;">
    <span style="font-weight:600;">Ir a estadÃ­sticas</span>
    <select id="pea-jump-stat" aria-label="Ir a estadÃ­sticas">
      <option value="">â€”</option>
    </select>
  </div>
</div>


              <div class="pea-filters-grid">

                <label>
                  Fecha desde
                  <input type="date" id="pea-filter-date-from" />
                </label>

                <label>
                  Fecha hasta
                  <input type="date" id="pea-filter-date-to" />
                </label>

                <label>
                  Momento
                  <select id="pea-filter-momento">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Pensamiento
                  <select id="pea-filter-pensamiento">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Estado
                  <select id="pea-filter-estado">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Intensidad
                  <select id="pea-filter-intensidad">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  AcciÃ³n
                  <select id="pea-filter-accion">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  DirecciÃ³n
                  <select id="pea-filter-direccion">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Activo
                  <select id="pea-filter-activo">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Instrumento
                  <select id="pea-filter-instrumento">
                    <option value="">â€”</option>
                  </select>
                </label>

                <label>
                  Activo (detalle)
                  <input
                    type="text"
                    id="pea-filter-activo-otros"
                    placeholder="Ej: Cripto futuros"
                  />
                </label>

                <label>
                  Instrumento (detalle)
                  <input
                    type="text"
                    id="pea-filter-instrumento-otros"
                    placeholder="Ej: BTC Futuro"
                  />
                </label>

                <label>
                  Estado del registro
                  <select id="pea-filter-record-state">
                    <option value="">â€”</option>
                    <option value="VALIDO">VALIDO</option>
                    <option value="ANULADO">ANULADO</option>
                    <option value="CORRECCION">CORRECCION</option>
                  </select>
                </label>

                <label>
                  Resultado operativo
                  <select id="pea-filter-resultado-operativo">
                    <option value="">â€”</option>
                    <option value="GANADA">GANADA</option>
                    <option value="PERDIDA">PERDIDA</option>
                    <option value="BE">BE</option>
                    <option value="NA">NA</option>
                  </select>
                </label>

                <label>
                  Momento estructural
                  <select id="pea-filter-momento-estructural">
                    <option value="">â€”</option>
                  </select>
                </label>

              </div>

              <div class="pea-filter-actions">
                <button id="pea-filter-apply" type="button">Aplicar filtros</button>
                <button id="pea-filter-clear" type="button">Quitar filtros</button>
              </div>

              <div class="pea-filter-actions" style="margin-top:8px; gap:6px;">
                <select id="pea-views-select"></select>

                <button id="pea-view-save" type="button">
                  Guardar vista
                </button>

                <button id="pea-view-apply" type="button">
                  Cargar vista
                </button>

                <button id="pea-view-delete" type="button">
                  Eliminar vista
                </button>

              </div>

              <div id="pea-filter-status" class="pea-filter-status" aria-live="polite"></div>
            </section>

            <!-- ZONA 2 - TABLA â€” REGISTROS CRUDOS (1 fila = 1 evidencia) -->
<section class="pea-table-wrap">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
    <h2 style="margin:0;">Registros</h2>

    <div style="display:flex; gap:8px; align-items:center;">
      <button type="button" class="btn-main" id="pea-btn-export-registros">Exportar registros</button>
      <button type="button" class="btn-main" id="pea-btn-export-historial">Exportar historial (todo)</button>
    </div>
  </div>

              <div style="margin:6px 0 10px 0;">
                Mostrar
                <select onchange="window.PEA_TABLE.setLimit(this.value)">
                  <option value="10" selected>10</option>
                  <option value="15">15</option>
                  <option value="20">20</option>
                </select>
                registros
              </div>

              <div class="pea-table-scroll">
                <table class="pea-table" aria-label="Tabla de registros PEA">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Momento</th>
                      <th>Resultado</th>
                      <th>Pensamiento</th>
                      <th>Estado (E)</th>
                      <th>Intensidad</th>
                      <th>AcciÃ³n(es)</th>
                      <th>DirecciÃ³n</th>
                      <th>Activo</th>
                      <th>Activo (detalle)</th>
                      <th>Instrumento</th>
                      <th>Instrumento (detalle)</th>
                      <th>Nota</th>
                      <th>Momento estructural</th>
                      <th>Estado registro</th>
                      <th>ID</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>

                  <tbody id="pea-table-body">
                    <!-- Render por pea_table.js -->
                  </tbody>
                </table>
              </div>

              <div id="pea-table-empty" class="pea-empty" style="display:none;">
                No hay registros para mostrar.
              </div>
            </section>

          </section>

        </div> <!-- ðŸ”´ CIERRE pea-zone-core-inner -->

        <!-- ZONA 3 â€” ESTADÃSTICAS (17) -->
        <section class="pea-zone pea-zone-secondary" aria-label="EstadÃ­sticas">

          <h2>EstadÃ­sticas</h2>

          <!-- NIVEL 0 -->
          <section class="pea-level" data-level="0" id="level-0">
            <div class="pea-card" style="margin-top:12px;">
              <div class="pea-level-content" id="pea-level-0"></div>
            </div>
          </section>

          <!-- NIVEL 1 -->
          <section class="pea-level" data-level="1" id="level-1">
            <div class="pea-card" style="margin-top:12px;">
              <div class="pea-level-content" id="pea-level-1"></div>
            </div>
          </section>

          <!-- NIVEL 2 -->
          <section class="pea-level" data-level="2" id="level-2">
            <div class="pea-card" style="margin-top:12px;">
              <div class="pea-level-content" id="pea-level-2"></div>
            </div>
          </section>

          <!-- NIVEL 3 -->
          <section class="pea-level" data-level="3" id="level-3">
            <div class="pea-card" style="margin-top:12px;">
              <div class="pea-level-content" id="pea-level-3"></div>
            </div>
          </section>

          <!-- NIVEL 4 (OCULTO POR DEFECTO) -->
          <section class="pea-level pea-level--collapsed" data-level="4" id="level-4">
            <div class="pea-card" style="margin-top:12px;">
              <div class="pea-level-content" id="pea-level-4"></div>
            </div>
          </section>

        </section>

        <!-- =========================
             ACCESOS RÃPIDOS (UX â€” BLOQUE 1 TAREA 6)
             ========================= -->

      </main>

    </div>
  </div>

  <!-- âœ… STORAGE GLOBAL (window.PEA_STORAGE) â€” NECESARIO PARA HISTORIAL -->
  <script src="./pea_theme.js"></script>
  <script src="./pea_storage.js"></script>


  <!-- BLOQUE 8 â€” HISTORIAL -->
  <script type="module" src="./pea_filters.js"></script>
  <script type="module" src="./pea_table.js"></script>
  <script type="module" src="./pea_metrics.js"></script>

<!-- =========================
     STATS PEA â€” ESTADÃSTICAS NIVEL 1 (BRUJULA DE PERDIDAS)
     ========================= -->
<script src="./stats/stat_01_brujula_perdidas.js"></script>
<script src="./stats/stat_02_top_pensamientos_perdidas.js"></script>
<script src="./stats/stat_03_top_acciones_perdidas.js"></script>
<script src="./stats/stat_04_top_emociones_perdidas_despues.js"></script>

  <!-- =========================
     STATS PEA â€” ESTADÃSTICAS NIVEL 2 (ESPEJO DE GANADAS)
     ========================= -->
<script src="./stats/stat_05_top_pensamientos_ganadas.js"></script>
<script src="./stats/stat_06_top_acciones_ganadas.js"></script>
<script src="./stats/stat_07_top_emociones_ganadas_despues.js"></script>

  <!-- =========================
     STATS PEA â€” ESTADÃSTICAS NIVEL 3 COMPARACIÃ“N REAL (OPERATIVO)
     ========================= -->
<script src="./stats/stat_08_indice_interferencia.js"></script>
<script src="./stats/stat_09_indice_cumplimiento.js"></script>
<script src="./stats/stat_10_balanza_cumplimiento_interferencia.js"></script>

  <!-- =========================
     STATS PEA â€” ESTADÃSTICAS NIVEL 4 SALUD, ESTRUCTURA Y CAMBIOS
     ========================= -->
<script src="./stats/stat_11_top_interferencias_por_resultado.js"></script>
<script src="./stats/stat_12_intensidad_por_resultado.js"></script>
<script src="./stats/stat_13_salud_del_dato.js"></script>
<script src="./stats/stat_14_momentos_estructurales_cambios.js"></script>
<script src="./stats/stat_15_acciones_criticas_por_resultado.js"></script>
<script src="./stats/stat_16_pensamientos_criticos_por_resultado.js"></script>
<script src="./stats/stat_17_estados_por_resultado.js"></script>

<script src="./stat_12_a_17_integrado.js?v=1"></script>  

<!-- REGISTRO DE ESTADÃSTICAS -->
<script src="./pea_stats_registry.js"></script>

<!-- Jump rÃ¡pido a estadÃ­sticas -->
<script src="./pea_jump_stat.js"></script>  

<script type="module" src="./pea_views.js"></script>

<!-- EXPORT libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- Export logic -->
<script src="./pea_export.js"></script>

</body>
</html>
